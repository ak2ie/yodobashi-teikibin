# 購入通知
定期購入が設定された商品の購入タイミングが来たら、通知する。

## バックグラウンドスクリプト
この処理はChrome起動時と1日ごとに実行する。

### 購入通知
#### 対象商品の抽出
購入タイミングが来た商品を、下記の条件でDBから検索する。

 - 個別注文の場合
    - 次回購入日 <= 今日の日付
    - 販売終了 = false
 - まとめて発送（指定日注文）の場合
    - 次回購入日の年月 = 購入指定日の年月
    - 購入指定日 <= 今日の日付
    - 販売終了 = false

#### カートに入れる
抽出した商品をカートに入れる。

小さいウィンドウを表示し、抽出した商品のURLを順に開き数量設定後、「ショッピングカートに入れる」ボタンを押下する。

カートに入れられなかった場合（販売終了など）は、DBを更新する。
 - カート投入失敗 = true
 - 販売終了フラグ = true（販売終了の場合のみ）

#### 前回購入日の更新
抽出した商品のうち、カートに入れられた商品の前回購入日を今日の日付に更新する。

#### 通知を表示
##### ブラウザアクション
アイコンを変更する

##### 画面右下の表示
購入タイミングが来たことを通知する

#### カート画面を表示した場合
ブラウザアクションまたは通知からカートを表示した場合のみ、下記の処理を行う。

購入タイミングが来たが、カートに入れられなかった商品を下記の条件でDBから抽出し、画面に表示する。

 - カート投入失敗 = true

表示後に、DBを更新する。

 - カート投入失敗 = false
