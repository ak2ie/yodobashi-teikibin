var _pkgPurchase=void 0;!function(){"use strict";function t(){return assetUrl}function e(){return PopupDialog}function n(t,e){"function"==typeof ctlg_js_deviceselect&&ctlg_js_deviceselect.appendCartInElement(t,e)}function s(t){var n=e();var s=$("#js_ppWarning").get(0).outerHTML;var i;s&&""!==s.trim()&&(i=new n(t,300,null,0),i.startLoading(!1),s=i.getPubox("js_ppWarning",$("#js_ppWarning").get(0).innerHTML),i.setContents("js_ppWarning",s,null,function(){var t=this.popupSelector();$(t).on("click",".js_ppClose",function(){i.hide()}),i.showContents()}))}function i(){_pkgPurchase=new l,_pkgPurchase.init()}var r=function(t){this.sku=t.sku,this.imgUrl=t.imgUrl,this.prdName=t.prdName,this.salesPrice=t.salesPrice,this.listPrice=t.listPrice,this.point=t.point,this.prdUrl=t.prdUrl,this.cartInTag=t.cartInTag};var a=function(t){this.cartInTagContainer=t.cartInTagContainer};a.prototype={addToContainer:function(t){t.removeClass(),this.cartInTagContainer.append(t)},removeFromContainer:function(t){$(t,this.cartInTagContainer).remove()},replaceCartInTag:function(t){var e=$('[id^="'+t+'"]',this.cartInTagContainer);var n;if(e.length)for(n=1;n<=e.length;n++)this.replaceChildrenIndexes(e[n-1],n),this.replaceDeviceSelect(e[n-1],n)},replaceChildrenIndexes:function(t,e){var n;var s;var i;for(n=0;n<t.childNodes.length;n++)s=t.childNodes[n].name,0===s.indexOf("products[")&&(i="products["+e+"]"+s.substr(14),t.childNodes[n].name=i)},deleteTagsOnCartIn:function(){$(".js_ppCartInTag").remove(),$('input[name="js_ppMeisaiCount"]').remove()},replaceDeviceSelect:function(t,e){var s;var i;for(s=0;s<t.childNodes.length;s++)i=t.childNodes[s].value,0===i.indexOf("isdevice")&&n(this.cartInTagContainer,e)}};var o=function(){this.norenImgAreaRoot=$("#js_norenPImgArea"),this.norenImgAreaOrg=this.norenImgAreaRoot.length?this.norenImgAreaRoot.html():"",this.norenInfoAreaRoot=$("#js_norenPInfoArea"),this.norenInfoAreaOrg=this.norenInfoAreaRoot.length?this.norenInfoAreaRoot.html():"",this.itemList=[],this.totalPrice=0,this.totalPoint=0,this.miniCsl=null};o.prototype={init:function(){this.switchToPpView();var t=this.setMainItemInfo();this.initCsl(t)},switchToPpView:function(){this.norenImgAreaRoot.length&&(this.norenImgAreaRoot.empty(),this.norenImgAreaRoot.append('<div class="ppItemThumbList"><a href="javascript:void(0);" class="prev js_prevBtn"><span></span></a><a href="javascript:void(0);" class="next js_nextBtn"><span></span></a><div class="carouselListBody pagnWrapper"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr id="js_norenCslList"><td>'+this.norenImgAreaOrg+"</td></tr></tbody></table></div></div>")),$(".js_ppPrdName",this.norenInfoAreaRoot).length&&$(".js_ppPrdName",this.norenInfoAreaRoot).append('<span class="fs11 ml10">ほか</span>'),$(".js_ppSalesInfo",this.norenInfoAreaRoot).length&&$(".js_ppSalesInfo",this.norenInfoAreaRoot).hide(),$(".js_ppSalesPrice",this.norenInfoAreaRoot).length&&$(".js_ppSalesPrice",this.norenInfoAreaRoot).hide(),$(".js_ppPoint",this.norenInfoAreaRoot).length&&$(".js_ppPoint",this.norenInfoAreaRoot).hide(),$(".js_ppSalesPrice",this.norenInfoAreaRoot).length&&$(".js_ppSalesPrice",this.norenInfoAreaRoot).parent().prepend('<strong class="js_ppTotalMsg"></strong>')},setMainItemInfo:function(){var t=new r({sku:$('input[name="products[0].cartInSKU"]').length?$('input[name="products[0].cartInSKU"]').val():"",imgUrl:$(".js_ppImgUrl",this.norenImgAreaRoot).length?$(".js_ppImgUrl",this.norenImgAreaRoot).attr("src"):"",prdName:"",salesPrice:$(".js_ppSalesPrice",this.norenInfoAreaRoot).length?$(".js_ppSalesPrice",this.norenInfoAreaRoot).text():"",listPrice:"",point:$(".js_ppPoint",this.norenInfoAreaRoot).length?$(".js_ppPoint",this.norenInfoAreaRoot).text():"",prdUrl:""});return this.itemList.push(t),this.totalPrice=t.salesPrice,this.totalPoint=t.point,t},initCsl:function(e){this.miniCsl=new $.miniCarousel({cslBody:$("#js_norenCslList",this.norenImgAreaRoot),prevBtn:$(".js_prevBtn",this.norenImgAreaRoot),nextBtn:$(".js_nextBtn",this.norenImgAreaRoot),displayCount:3}),this.miniCsl.init(),this.miniCsl.blockList.push(this.getBlockHtml(e)),this.miniCsl.plusIcon='<td><div class="iconPlus js_iconPlus"><img src="'+t()+'common/add/img/iconPlus.png"></div></td>'},reset:function(){var t;this.norenImgAreaRoot.length&&(t=$(this.norenImgAreaOrg),t.length&&(t.hide(),this.norenImgAreaRoot.html(t),$.utils.animShowFadeArea(t,!0))),this.norenInfoAreaRoot.length&&this.norenInfoAreaRoot.html(this.norenInfoAreaOrg),this.itemList=[],this.miniCsl.blockList=[]},addItem:function(t){this.itemList.push(t),this.miniCsl.addBlock(this.getBlockHtml(t)),this.display()},getBlockHtml:function(t){var e='<td class="imgUnit js_ppSku'+t.sku+'">'+(t.prdUrl?'<a href="'+t.prdUrl+'" target="_blank">':"")+'<img src="'+t.imgUrl+'">'+(t.prdUrl?"</a>":"")+"</td>";return e},removeItem:function(t){var e=null;var n=0;for(n=0;n<this.itemList.length;n++)if(this.itemList[n].sku===t){e=this.itemList[n],this.itemList.splice(n,1),this.miniCsl.removeBlock(n);break}this.display()},display:function(){this.norenInfoAreaRoot.length&&$(".js_ppPrdName",this.norenInfoAreaRoot).length&&$(".js_ppPrdName",this.norenInfoAreaRoot).next().hide()},calcTotalPrice:function(t,e){var n="￥";var s=parseInt(this.totalPrice.replace(n,"").replace(/,/g,""));var i=parseInt(t.replace(n,"").replace(/,/g,""));return e||(i*=-1),n+(s+i).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},calcTotalPoint:function(t,e){var n="ポイント";var s=parseInt(this.totalPoint.substring(0,this.totalPoint.indexOf(n)).replace(/,/g,""));var i=parseInt(t.substring(0,t.indexOf(n)).replace(/,/g,""));return e||(i*=-1),(s+i).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+n}};var l=function(){this.MEISAI_MAX=40,this.meisaiCnt=1,this.pkgPurchaseItemList=[],this.buyBoxRoot=$("#js_buyBoxMain"),this.norenPP=null,this.multiCartIn=null};l.prototype={init:function(){this.multiCartIn=new a({cartInTagContainer:$("#js_ppCartInTags")}),this.norenPP=new o},checkMeisaiCnt:function(){var t=$('input[name="js_ppMeisaiCount"]');t.length&&t.val()>0&&(this.meisaiCnt+=parseInt(t.val()),t.remove())},bindToggleEvent:function(t){var e=this;var n=$(".js_ppCheckBox",t);n.length&&n.unbind("click").click(function(t){var n=e.toggleSelection($.utils.getRootBlockByClass($(this),"js_ppSku"));return t.stopPropagation(),n});var s=$("a",t);s.length&&s.unbind("click").click(function(t){t.stopPropagation()})},toggleSelection:function(t){var e=this.getSkuFromClass(t.attr("class"));var n=!0;var s;if(this.pkgPurchaseItemList.length>0)for(s=0;s<this.pkgPurchaseItemList.length;s++)if(this.pkgPurchaseItemList[s].sku===e){n=!1;break}var i=new r({sku:e,imgUrl:$(".js_ppImgUrl",t).length?$(".js_ppImgUrl",t).attr("src"):"",prdName:$(".js_ppPrdName",t).length?$(".js_ppPrdName",t).html():"",salesPrice:$(".js_ppSalesPrice",t).length?$(".js_ppSalesPrice",t).text():"",listPrice:$(".js_ppListPrice",t).length?$(".js_ppListPrice",t).text():"",point:$(".js_ppPoint",t).length?$(".js_ppPoint",t).text():"",prdUrl:$(".js_ppPrdUrl",t).length?$(".js_ppPrdUrl",t).attr("href"):"",cartInTag:$("#js_ppCartIn-"+e,t.parent())});return n?this.selectProduct(i):void this.deselectProduct(i.sku)},toggleRecBlock:function(t,e){var n=t.parent();var s=$(".js_ppCheckBox",t);e?(n.hasClass("active")||n.addClass("active"),s.length&&!s.attr("checked")&&s.attr("checked","checked")):(n.hasClass("active")&&n.removeClass("active"),s.length&&s.attr("checked")&&s.removeAttr("checked"))},toggleAllRecSlots:function(t,e){var n=this;$(".js_carousel_contents ").each(function(){$(".js_ppSku"+t,$(this)).each(function(){n.toggleRecBlock($(this),e)})})},selectProduct:function(t){var e;return this.checkMeisaiCnt(),this.meisaiCnt>=this.MEISAI_MAX?(this.popupWarning(),!1):(e=0===this.pkgPurchaseItemList.length,this.pkgPurchaseItemList.push(t),e&&this.initContainers(),this.disableTwClickBtn(),this.toggleAllRecSlots(t.sku,!0),this.norenPP.addItem(t),this.addToBuyBox(t),this.multiCartIn.addToContainer(t.cartInTag.clone()),this.meisaiCnt+=1,!0)},addToBuyBox:function(t){var e=$("#js_pkgPurchaseList",this.buyBoxRoot);var n;var s;var i;var r;var a;e.length&&(n=$(".js_ppSku"+t.sku,e),n.length?(s=$(".js_ppCheckBox",n),s.length&&!s.attr("checked")&&s.attr("checked","checked"),i=$(".js_ppItemInfo",n),i.length&&i.hasClass("disabled")&&i.removeClass("disabled")):(r=$(document).height(),e.append('<div class="packagePurchaseItem js_ppSku'+t.sku+'"><div class="ppSlctChk"><input type="checkbox" checked="checked" class="js_ppCheckBox"></div>'+$("<div>").append(t.cartInTag.clone()).html()+'<div class="ppItemInfo js_ppItemInfo"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="imgArea"><div class="pImg"><a href="'+t.prdUrl+'" target="_blank" class="js_ppPrdUrl"><img src="'+t.imgUrl+'" class="js_ppImgUrl"></a></div></td><td class="infoArea"><ul><li><a href="'+t.prdUrl+'" target="_blank" class="js_ppPrdName">'+t.prdName+'</a></li><li><span class="red js_ppSalesPrice">'+t.salesPrice+'</span></li><li><span class="orange js_ppPoint">'+t.point+"</span></li></ul></td></tr></tbody></table></div></div>"),a=$(document).height()-r,$(document).scrollTop($(document).scrollTop()+a)),this.bindToggleEvent(e))},disableTwClickBtn:function(){$(".js_twClickCartInEnable").hide()},enableTwClickBtn:function(){$(".js_twClickCartInEnable").show()},initContainers:function(){var t;var e;this.buyBoxRoot.length&&($("#js_pkgPurchaseList",this.buyBoxRoot).length||(t=$(document).height(),$(this.buyBoxRoot).append('<div class="packagePurchase"><div class="ppBody"><div class="packagePurchaseItemList" id="js_pkgPurchaseList"></div></div><div class="ppTail js_ppTail"></div></div>'),e=$(document).height()-t,$(document).scrollTop($(document).scrollTop()+e))),this.norenPP.init()},deselectProduct:function(t){var e=1===this.pkgPurchaseItemList.length;var n=null;for(var s=0;s<this.pkgPurchaseItemList.length;s++)if(this.pkgPurchaseItemList[s].sku===t){n=s;break}this.multiCartIn.removeFromContainer("#"+this.pkgPurchaseItemList[n].cartInTag.attr("id")),null!==n&&this.pkgPurchaseItemList.splice(n,1),this.toggleAllRecSlots(t,!1),this.norenPP.removeItem(t),this.removeFromBuyBox(t),e&&(this.norenPP.reset(),this.enableTwClickBtn()),this.meisaiCnt-=1},removeFromBuyBox:function(t){var e=$(".js_ppSku"+t,$("#js_pkgPurchaseList"));var n;var s;e.length&&(n=$(".js_ppItemInfo",e),n.length&&!n.hasClass("disabled")&&n.addClass("disabled"),s=$(".js_ppCheckBox",e),s.length&&s.attr("checked")&&s.removeAttr("checked"))},switchPpMode:function(t){$("a",t).attr("target","_blank");var e=$('[class*="js_ppSku"]',t);this.addPpClassId(t,e)&&(this.checkAlreadySelected(e),this.bindToggleEvent(t))},addPpClassId:function(t,e){var n=$(".js_ppCartInTag",t);var s=$(".js_ppCheckBox",t);var i=this.getSkuFromClass(e.attr("class"));var r="entrySelector multiLinkable js_ppBlock";return n.length&&i.length&&s.length?(n.attr("id","js_ppCartIn-"+i),t.addClass(r),!0):(t.removeClass(r),t.unbind("click"),n.length&&n.remove(),s.length&&s.parent().remove(),!1)},checkAlreadySelected:function(t){var e;var n;var s=0;if(t.length){for(e=this.getSkuFromClass(t.attr("class")),n=!1,s=0;s<this.pkgPurchaseItemList.length;s++)if(this.pkgPurchaseItemList[s].sku===e){n=!0;break}this.toggleRecBlock(t,n)}},getSkuFromClass:function(t){if(t){var e=new RegExp(/js_ppSku([^\\s+]*)/);var n=e.exec(t);return null===n||n.length<2?"":n[1]}return""},preparePpCartInTags:function(t){"p2"===t||"p3"===t?this.multiCartIn.cartInTagContainer.remove():this.multiCartIn.replaceCartInTag("js_ppCartIn-"),this.multiCartIn.deleteTagsOnCartIn()},popupWarning:function(){s("js_ppSku")}},$(function(){i()})}();